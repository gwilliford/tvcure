---
title: "Example Code"
author: "George Williford"
date: "9/12/2019"
output:
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message = F}
library(tvcure)
library(snow)
library(foreach)
library(doParallel)
library(doSNOW)
library(smcure)
data(e1684)
```

# Estimate model
Here is an example of a model using data on melanoma recurrence. It predicts recurrence as a function of a Treatment, Age, and Sex to predict both the probability of being cured and the time until recurrence for uncured patients. The results for this toy example are insignificant, but it should provide some idea of how the software works.
```{r, message = F, results = F}
cl <- makeCluster(4, "SOCK"); registerDoSNOW(cl)
pd <- tvcure(Surv(FAILTIME, FAILCENS) ~ TRT + SEX + AGE, cureform = ~ TRT + SEX + AGE, data = e1684, model = "ph", parallel = T)
```

# Summary of model
```{r}
summary(pd)
```


# Create a table (can be exported to latex using the xtable package)
```{r}
tvtable(pd, format = "wide", qi = "se", stars = T, digits = 3)
```

# Plots
The package can plot several different quantities of interest based on the model. The confidence intervals will overlap since the results aren't significant for this example. 

This code plots the baseline survivor function for the entire population.
```{r}
testpred1a <- prediction2(pd, variable = "TRT", values = c(0:1), type = "basesurv", CI = T, nsims = 100); testpred1a
```

This code plots the probability that an individual is not cured for at different values of TRT.
```{r}
testpred1d <- prediction2(pd, variable = "TRT", values = c(0:1), type = "uncureprob", CI = T, nsims = 100); testpred1d
```

The following code plots the survival function for only those individuals who are not cured, i.e., those that will fail. In other words, conditional on the probability that an individual with TRT = 0 fails, what is the survivor function for individuals with TRT = 0. This code plots the survivor functions for both 0 and 1.
```{r}
testpred1b <- prediction2(pd, variable = "TRT", values = c(0:1), type = "suncure", CI = T, nsims = 100); testpred1b
```

The following code plots the survival function for the entire population, both those that will fail and those that won't. In other words, what is the survivor function for all individuals when TRT = 0 (accounting for both the probability of failure and the effect on survivor time for uncured patients). This code plots the survivor functions for both 0 and 1.
```{r}
testpred1c <- prediction2(pd, variable = "TRT", values = c(0:1), type = "spop", CI = T, nsims = 100); testpred1c
```



